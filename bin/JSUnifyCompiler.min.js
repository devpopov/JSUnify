(function(){var n,t,e,r,o,u,i,l,s,a,f,c=[].slice,p={}.hasOwnProperty,g=function(n,t){function e(){this.constructor=n}for(var r in t)p.call(t,r)&&(n[r]=t[r]);return e.prototype=t.prototype,n.prototype=new e,n.__super__=t.prototype,n};f="undefined"==typeof module?window.unify:require("unify"),"undefined"==typeof module&&(window.JSUnify={}),l=function(n,t){return"undefined"==typeof module?window.JSUnify[n]=t:module.exports[n]=t};for(a in f)l(a,f[a]);n=function(){function n(n){this.level=0,this.logger=n}return n.prototype.event=function(n,t){return("fail"===n||"exit"===n)&&this.level--,this.logger.log(""+this.level+" "+n+": "+t),"call"===n?this.level++:void 0},n}(),r=function(){function n(){this.rules=[],this.settings={debug:!1}}return n.prototype.run=function(n){var e;return n=f.box(n),e=function(t,e,r){return console.log(t+": "+(""+e.goal)),"success"===t&&console.log(n.unbox()),null!==r?r():void 0},u(this.rules,[new t([n])],e)},n.prototype.rule=function(){var n,t;return t=arguments[0],n=arguments.length>=2?c.call(arguments,1):[],this.rules.push(function(n,t,e){e.prototype=n.prototype;var r=new e,o=n.apply(r,t);return Object(o)===o?o:r}(o,[t].concat(c.call(n)),function(){})),this},n.prototype.iff=function(n){var t;if(0===this.rules.length)throw"iff is invalid in this context. A rule must be created first!";return t=this.rules[this.rules.length-1],t.iff(n),this},n.prototype.load=function(n){var t,e,r;for(e=0,r=n.length;r>e;e++)t=n[e],this.rules.push(t);return this},n}(),o=function(){function n(){var n,t,e,r,o;for(e=arguments[0],t=arguments.length>=2?c.call(arguments,1):[],this.fact=e,this.tin=f.box(e),this.conditions=[],r=0,o=t.length;o>r;r++)n=t[r],this.iff(n)}return n.prototype.iff=function(n){var t,r,o,u,i;if(n=f.types.isFunc(n)?new e(n):f.box(n),0===this.conditions.length){t={},u=this.tin.varlist;for(r in u)o=u[r],t[r]=o}else t=this.conditions[0].varlist;i=n.varlist;for(r in i)o=i[r],void 0===t[r]&&(t[r]=o);return n.varlist=t,this.conditions.push(n),this},n}(),e=function(n){function t(n){this.func=n,t.__super__.constructor.call(this,null,null,{})}return g(t,n),t.prototype.toString=function(){return(""+this.func).replace(/(\r\n|\n|\r)/gm,"")},t}(f.TreeTin),t=function(){function n(n){this.subgoals=n,this.goal=this.subgoals.shift(),this.currentRule=0}return n}(),u=function(n,r,o){var i,l,s,a;if(i=r[r.length-1],l=i.goal,a=!1,s=null,0===i.currentRule?o("try",{goal:l},null):(o("retry",{goal:l},null),l.rollback()),l instanceof e)0===i.currentRule&&l.func(l)&&(a=!0,i.currentRule++);else for(;i.currentRule<n.length;){if(l.unify(n[i.currentRule].tin)){a=!0,s=n[i.currentRule],i.currentRule++;break}i.currentRule++}a?null!==s&&0!==s.conditions.length?(r.push(new t(s.conditions.concat(i.subgoals))),o("subgoals",{goal:l,subgoals:i.subgoals},null),o("next",{goal:l},function(){return u(n,r,o)})):0===i.subgoals.length?o("success",{goal:l},function(){return u(n,r,o)}):(r.push(new t(i.subgoals)),o("next",{goal:l},function(){return u(n,r,o)})):(r.pop(),0===r.length?(o("fail",{goal:l},null),o("done",{goal:l},null)):o("fail",{goal:l},function(){return u(n,r,o)}))},l("Rule",o),l("Program",r),s="undefined"==typeof module?window.falafel:require("free-falafel"),i=function(n){var t,e,r,o,u;return e=function(n){var t,e,r;null!==n.unifyType&&(t=Array(n.unifyIndent+5).join(" "),"JsUnifyCall"===n.unifyType?n.update(["(function(){","var JSUnify = typeof(module) == 'undefined' || typeof(require) == 'undefined' ? window.JSUnify : require('jsunify');","var $var = JSUnify.variable;",n.isUnifyProg?"return new JSUnify.Program()\n"+n.arguments[0].source():"return "+n.arguments[0].source()+";","})()"].join("\n"+t)):"ProgramRoot"===n.unifyType?n.update(n.body.source()):"OutCall"===n.unifyType?"LogicalExpression"===n.type||"BinaryExpression"===n.type?n.update(""+n.left.source()+", "+n.right.source()):"ExpressionStatement"===n.type?n.update(""+t+".rule("+n.expression.source()+")"):"BlockStatement"===n.type&&n.update(function(){var t,r,o,u;for(o=n.body,u=[],t=0,r=o.length;r>t;t++)e=o[t],u.push(e.source());return u}().join("\n")):("ExprRoot"===n.unifyType||"InCall"===n.unifyType)&&("CallExpression"===n.type?n.update(['["'+n.callee.name+'",',function(){var t,r,o,u;for(o=n.arguments,u=[],t=0,r=o.length;r>t;t++)e=o[t],u.push(e.source());return u}().join(","),"]"].join("")):"Identifier"===n.type?n.update('$var("'+n.name+'")'):("LogicalExpression"===n.type||"BinaryExpression"===n.type)&&(r={"+":"add","-":"sub","*":"mult","/":"div","==":"eq","===":"eq","%":"mod","!=":"neq","!==":"neq",">":"greater","<":"less",">=":"greaterOrEqual","<=":"lessOrEqual","&&":"and","||":"or"},null!=r[n.operator]&&n.update('["'+r[n.operator]+'", '+n.left.source()+", "+n.right.source()+"]"))))},u=function(n){return"CallExpression"===n.type&&"$jsunify"===n.callee.name},o=function(n){return null!=n.parent&&u(n.parent)},r={ProgramRoot:"OutCall",ExprRoot:"InCall",ProgramRoot:"OutCall",InCall:"InCall",OutCall:"OutCall"},t=function(n){var t,e,i;u(n)?(n.unifyType="JsUnifyCall",n.unifyIndent=n.loc.start.column):o(n)?(n.unifyType="FunctionExpression"===n.type?"ProgramRoot":"ExprRoot",n.isUnifyProg="FunctionExpression"===n.type,n.parent.isUnifyProg=n.isUnifyProg):n.unifyType="FunctionExpression"===n.type?null:"CallExpression"===n.type&&null!=(null!=(t=n.parent)?t.unifyType:void 0)?"InCall":null!=n.parent?null===n.parent.unifyType?null:r[n.parent.unifyType]:null,null!==n.unifyType&&null!=(null!=(e=n.parent)?e.isUnifyProg:void 0)&&null==n.isUnifyProg&&(n.isUnifyProg=n.parent.isUnifyProg),null!==n.unifyType&&null==n.unifyIndent&&null!=(null!=(i=n.parent)?i.unifyIndent:void 0)&&(n.unifyIndent=n.parent.unifyIndent)},""+s(n,{loc:!0},e,t)},l("compile",i)}).call(this);