(function(){var t,n,e,o,r,u,i,l,s,c=[].slice,f={}.hasOwnProperty,a=function(t,n){function e(){this.constructor=t}for(var o in n)f.call(n,o)&&(t[o]=n[o]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};s="undefined"==typeof module?window.unify:require("unify"),"undefined"==typeof module&&(window.JSUnify={}),i=function(t,n){return"undefined"==typeof module?window.JSUnify[t]=n:module.exports[t]=n};for(l in s)i(l,s[l]);t=function(){function t(t){this.level=0,this.logger=t}return t.prototype.event=function(t,n){return("fail"===t||"exit"===t)&&this.level--,this.logger.log(""+this.level+" "+t+": "+n),"call"===t?this.level++:void 0},t}(),o=function(){function t(){this.rules=[],this.settings={debug:!1}}return t.prototype.run=function(t){var e;return t=s.box(t),e=function(n,e,o){return console.log(n+": "+(""+e.goal)),"success"===n&&console.log(t.unbox()),null!==o?o():void 0},u(this.rules,[new n([t])],e)},t.prototype.rule=function(){var t,n;return n=arguments[0],t=arguments.length>=2?c.call(arguments,1):[],this.rules.push(function(t,n,e){e.prototype=t.prototype;var o=new e,r=t.apply(o,n);return Object(r)===r?r:o}(r,[n].concat(c.call(t)),function(){})),this},t.prototype.iff=function(t){var n;if(0===this.rules.length)throw"iff is invalid in this context. A rule must be created first!";return n=this.rules[this.rules.length-1],n.iff(t),this},t.prototype.load=function(t){var n,e,o;for(e=0,o=t.length;o>e;e++)n=t[e],this.rules.push(n);return this},t}(),r=function(){function t(){var t,n,e,o,r;for(e=arguments[0],n=arguments.length>=2?c.call(arguments,1):[],this.fact=e,this.tin=s.box(e),this.conditions=[],o=0,r=n.length;r>o;o++)t=n[o],this.iff(t)}return t.prototype.iff=function(t){var n,o,r,u,i;if(t=s.types.isFunc(t)?new e(t):s.box(t),0===this.conditions.length){n={},u=this.tin.varlist;for(o in u)r=u[o],n[o]=r}else n=this.conditions[0].varlist;i=t.varlist;for(o in i)r=i[o],void 0===n[o]&&(n[o]=r);return t.varlist=n,this.conditions.push(t),this},t}(),e=function(t){function n(t){this.func=t,n.__super__.constructor.call(this,null,null,{})}return a(n,t),n.prototype.toString=function(){return(""+this.func).replace(/(\r\n|\n|\r)/gm,"")},n}(s.TreeTin),n=function(){function t(t){this.subgoals=t,this.goal=this.subgoals.shift(),this.currentRule=0}return t}(),u=function(t,o,r){var i,l,s,c;if(i=o[o.length-1],l=i.goal,c=!1,s=null,0===i.currentRule?r("try",{goal:l},null):(r("retry",{goal:l},null),l.rollback()),l instanceof e)0===i.currentRule&&l.func(l)&&(c=!0,i.currentRule++);else for(;i.currentRule<t.length;){if(l.unify(t[i.currentRule].tin)){c=!0,s=t[i.currentRule],i.currentRule++;break}i.currentRule++}c?null!==s&&0!==s.conditions.length?(o.push(new n(s.conditions.concat(i.subgoals))),r("subgoals",{goal:l,subgoals:i.subgoals},null),r("next",{goal:l},function(){return u(t,o,r)})):0===i.subgoals.length?r("success",{goal:l},function(){return u(t,o,r)}):(o.push(new n(i.subgoals)),r("next",{goal:l},function(){return u(t,o,r)})):(o.pop(),0===o.length?(r("fail",{goal:l},null),r("done",{goal:l},null)):r("fail",{goal:l},function(){return u(t,o,r)}))},i("Rule",r),i("Program",o)}).call(this);