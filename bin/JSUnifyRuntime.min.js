(function(){var t,n,i,r,o,e,u,s,f,l=[].slice,c={}.hasOwnProperty,h=function(t,n){function i(){this.constructor=t}for(var r in n)c.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};f="undefined"==typeof module?window.unify:require("unify"),"undefined"==typeof module&&(window.JSUnify={}),o=function(t,n){return"undefined"==typeof module?window.JSUnify[t]=n:module.exports[t]=n};for(e in f)o(e,f[e]);n=function(){function t(){this.rules=[],this.settings={}}return t.prototype.run=function(t){return t=new i(t),r(t,this.rules)},t.prototype.rule=function(){var t,n;return n=arguments[0],t=arguments.length>=2?l.call(arguments,1):[],this.rules.push(function(t,n,i){i.prototype=t.prototype;var r=new i,o=t.apply(r,n);return Object(o)===o?o:r}(i,[n].concat(l.call(t)),function(){})),this},t.prototype.iff=function(t){var n;if(0===this.rules.length)throw"iff is invalid in this context. A rule must be created first!";return n=this.rules[this.rules.length-1],n.iff(t),this},t.prototype.load=function(t){var n,i,r;for(i=0,r=t.length;r>i;i++)n=t[i],this.rules.push(n);return this},t}(),i=function(){function n(){var t,n,i,r,o;for(i=arguments[0],n=arguments.length>=2?l.call(arguments,1):[],this.fact=i,this.tin=f.box(i),this.conditions=[],r=0,o=n.length;o>r;r++)t=n[r],this.iff(t)}return n.prototype.iff=function(n){var i,r,o,e,u;if(n=f.types.isFunc(n)?new t(n):f.box(n),0===this.conditions.length){i={},e=this.tin.varlist;for(r in e)o=e[r],i[r]=o}else i=this.conditions[0].varlist;u=n.varlist;for(r in u)o=u[r],void 0===i[r]&&(i[r]=o);return n.varlist=i,this.conditions.push(n),this},n}(),t=function(t){function n(t){this.func=t,n.__super__.constructor.call(this,null,null,{})}return h(n,t),n.prototype.toString=function(){return"new FunctionCondition("+toJson(this.node)+", "+toJson(this.varlist)+")"},n}(f.TreeTin),r=function(n,r){var o,e,f,l,c;for(n instanceof i&&(n=[n.tin]),o=n.pop(),l=0,c=r.length;c>l;l++)if(f=r[l],e=o instanceof t?u(o,f,n,r):s(o,f,n,r),null!==e)return e;return n.push(o),null},s=function(t,n,i,o){var e,u,s,f,l;if(e=[],t.unify(n.tin)){for(n.conditions.reverse(),l=n.conditions,s=0,f=l.length;f>s;s++)u=l[s],i.push(u);if(n.conditions.reverse(),0===i.length)return t;if(null!==r(i,o))return t}return t.rollback(),null},u=function(t){return t.func(t)?t:null},o("Rule",i),o("Program",n)}).call(this);