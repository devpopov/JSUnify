(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D;N=function(e){return console.log(e)},l=function(e){return console.dir(e)},T=function(e){return e.length},typeof exports=="undefined"&&(window.JSUnify={}),c=function(e,t){return typeof exports=="undefined"?window.JSUnify[e]=t:exports[e]=t},typeof exports=="undefined"?window.JSUnify.internal={}:exports.internal={},d=function(e,t){return typeof exports=="undefined"?window.JSUnify.internal[e]=t:exports.internal[e]=t},A=function(e){return typeof e=="undefined"?"undefined":e===null?"null":e.toString()},C=function(){var e,t,n,r,i,s;n={};for(i=0,s=arguments.length;i<s;i++){e=arguments[i];for(t in e)r=e[t],n[t]=r}return n},S=function(e){return typeof e=="undefined"},g=function(e){return typeof e=="boolean"},m=function(e){return e!=null&&Array.isArray(e)},E=function(e){return typeof e=="string"},b=function(e){return typeof e=="number"},w=function(e){return e!==null&&!m(e)&&typeof e=="object"},x=function(e){return g(e)||E(e)||b(e)},y=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},O=function(t){var r;return m(t)?"["+function(){var e,n,i;i=[];for(e=0,n=t.length;e<n;e++)r=t[e],i.push(O(r));return i}().join(",")+"]":t instanceof e||t instanceof i||t instanceof o||t instanceof n?A(t):w(t)?"{"+function(){var e;e=[];for(r in t)e.push(r+":"+O(t[r]));return e}().join(",")+"}":E(t)?'"'+t+'"':A(t)},n=function(){function e(){}return e.prototype.toString=function(){return"new DictFlag()"},e}(),t=new n,e=function(){function e(e){if(!x(e)&&e!==null)throw"Can only box value types, not "+O(e);this.value=e}return e.prototype.toString=function(){return"new Box("+O(this.value)+")"},e}(),h=1,r="__B3qgfO__",v=function(e){return e.slice(0,r.length)===r},o=function(){function e(e){e==="_"?(this.name=r+h,h+=1):this.name=e}return e.prototype.isHiddenVar=function(){return v(this.name)},e.prototype.toString=function(){return"Var("+O(this.name)+")"},e}(),s=function(e){return new o(e)},i=function(){function t(e,t,n){this.node=t!=null?t:null,this.varlist=w(n)?n:null,this.chainlength=1,this.name=e}return t.prototype.end_of_chain=function(){var e;e=this;while(e.varlist instanceof t)e=e.varlist;return e},t.prototype.isfree=function(){var e;return e=this.end_of_chain(),e.node===null&&e.varlist===null},t.prototype.isHiddenVar=function(){return v(this.name)},t.prototype.toString=function(){return"new Tin("+O(this.name)+", "+O(this.node)+", "+O(this.varlist)+")"},t.prototype.get=function(t){var n,r;r=this.varlist[t],r!==null&&r!==void 0&&(r=r.end_of_chain());if(r==null)throw"Variable "+t+" not in this tin";if(r.node==null||r.node===null)return new s(r.name);if(r.node instanceof e)return M(r.node,r.varlist);if(r.node instanceof s)return M(r.node,r.varlist);if(m(r.node))return function(){var e,t,i,s;i=r.node,s=[];for(e=0,t=i.length;e<t;e++)n=i[e],s.push(M(n,r.varlist));return s}();throw"Unknown type in get"},t.prototype.get_all=function(){var e,t;e={};for(t in this.varlist)v(t)||(e[t]=this.get(t));return e},t.prototype.unparse=function(){return M(this.node)},t}(),f=function(n,r){var s,u,a;if(n instanceof o)return r!=null&&(r[n.name]=new i(n.name,null,null)),n;if(n instanceof e)return n;if(m(n))return function(){var e,t,i;i=[];for(e=0,t=n.length;e<t;e++)u=n[e],i.push(f(u,r));return i}();if(w(n)){s=[];for(a in n)s.push([f(a,r),f(n[a],r)]);return s.push(t),s.sort()}if(x(n||n===null))return new e(n);throw"Don't understand the type of elem"},M=function(n,r){var i,s,u,a,f,l,c;if(m(n)){if(n[n.length-1]===t){s=new Object,c=n.slice(0,n.length-1);for(f=0,l=c.length;f<l;f++)i=c[f],s[M(i[0])]=M(i[1]);return s}return function(){var e,t,r;r=[];for(e=0,t=n.length;e<t;e++)u=n[e],r.push(M(u));return r}()}if(n instanceof e)return n.value;if(n instanceof o){if(r!==void 0){try{a=p(r,n)}catch(h){return n}return M(a.node,a.varlist)}return n}throw"Unrecognized type '"+typeof n+"' in unboxit"},k=function(e){var t,n;return t={},n=f(e,t),new i(null,n,t)},p=function(e,t){if(!t instanceof o)throw"Node must be a Var to get_tin";if((e!=null?e[t.name]:void 0)!=null)return e[t.name];throw"Couldn't find node "+t.name+" in varlist "+e},u=function(e,t,n,r){return e=e.end_of_chain(),e.isfree()?(e.node=t,e.varlist=n,r.push(function(){return e.node=null,e.varlist=null,e.chainlength=1})):!1},a=function(e,t,n){return!e.isfree()&&!t.isfree()?!1:e.isfree()&&!t.isfree()?u(e,t.node,t.varlist,n):!e.isfree()&&t.isfree()?u(t,e.node,e.varlist,n):t.chainlength<e.chainlength?(t.chainlength+=1,u(t,null,e,n)):(e.chainlength+=1,u(e,null,t,n))},D=function(t,n,r,i,s){var f,l,c,h,d,v,g;s==null&&(s=[]);if(t===void 0&&r===void 0)return!0;if(t===null&&r===null)return!0;if(t===null||r===null)return!1;if(t instanceof o&&r instanceof o){c=p(n,t),h=p(i,r);if(!a(c,h,s)&&!D(c.node,c.varlist,h.node,h.varlist,s))return!1}else if(t instanceof o){c=p(n,t);if(!u(c,r,i,s)&&!D(c.node,c.varlist,r,i,s))return!1}else if(r instanceof o){h=p(i,r);if(!u(h,t,n,s)&&!D(h.node,h.varlist,t,n,s))return!1}else{if(t instanceof e&&r instanceof e&&x(t.value)&&x(r.value))return t.value===r.value;if(m(t)&&m(r)){if(t.length!==r.length)return!1;g=function(){var e,n,r;r=[];for(l=e=0,n=t.length;0<=n?e<=n:e>=n;l=0<=n?++e:--e)r.push(l);return r}();for(d=0,v=g.length;d<v;d++){f=g[d];if(!D(t[f],n,r[f],i,s))return!1}}}return!0},_=function(e,t,n){var r;return n==null&&(n=[]),r=!0,e=e instanceof i?e:k(e),t=t instanceof i?t:k(t),r=D(e.node,e.varlist,t.node,t.varlist,n),r===!1?null:[e,t]},L=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(t());return i},c("parse",k),c("unify",_),c("Var",s),d("Tin",i),d("Box",e),d("DictFlag",n),d("toJson",O),d("Variable",o),c("rollback",L)}).call(this)